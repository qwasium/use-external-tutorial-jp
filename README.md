# use-external-tutorial-jp

Japanese tutorial for using external files.

This repo is written in Japanese.

---

## はじめに

このリポジトリは、初心者を対象としています。

プログラミングを学習中に、外部ファイルに関連した操作でつまずくケースが意外と多いみたいです。

- ファイルの読み込み、書き込み
- 関数やクラスの呼び出し

そこで、外部ファイルを扱う際の基本的な操作をまとめました。

言語によって思想の違いはありますが、基本的な操作は共通しています。

その他にも個人的に便利だと思ったスニペットもいれています。

## Python

以下のファイルを参照してください。

**/python/example.ipynb**


## MATLAB/Octave


## R


---



　**重要！**　このファイルに限らず、`README`という名前のファイルがあったらまず最初に開いて読む癖をつけましょう。
`README`にはユーザーに知ってほしいことを書くことになっています。これは世界共通ですので覚えておきましょう。

このファイルはマークダウンという形式のファイルです（拡張子".md"）。
マークダウンファイルは簡単な文体修飾機能をつけたテキストファイルの様なものです。
めちゃ簡単で、メモアプリからブログまで広く使われているので初めましての方は勉強だと思ってまずは以下のウェブサイトを開いて読んでみましょう。

[マークダウンの基本：https://tracpath.com/works/development/markdown_basics/](https://tracpath.com/works/development/markdown_basics/)

---

## コンテンツ



## コーディング規約？？

- コーディング規約とは、チームでプログラミングを行う際に皆で守るルールのことです。
- コーディング規約では変数の命名規則やコメントの入れ方、かっこのつけ方まで様々なことが決められます。また、コーディング規約は目的に応じてプロジェクトごとに個別に設定されます。

[コーディング規約についての参考リンク：https://qiita.com/tadnakam/items/5d1280559eb75b29847c](https://qiita.com/tadnakam/items/5d1280559eb75b29847c)

<br>

## 檀ラボの実情

- 檀ラボでは、**実行環境に依存したコーディングが横行しており、保守性が著しく低いコードが問題となっております**。
- 具体的には、以下のような例が挙げられます。
  - 特定のPython環境で開発されたにも関わらず、その環境に関する記載がどこにも無いために動作が困難な.pyファイル。
  - 特定のディレクトリでのみ動作するコードであるが故に、ファイルを移動させた場合に動作しないコード
  - コメントやREADMEが全く無いために誰がいつ、何のプロジェクトで書いたかわからないコード
  - 構造が無駄に複雑で可読性や保守性が低く、書いた人ですらよくわからない状態になっているコード
- 即ち、**ゴミ**です。
**今の現状は100%先輩に原因があります**。
- せっかく自分の貴重な時間と労力を費やして書くコードなのですから、**価値が高いコード**を心がけましょう！

<br>

## 価値の高いコードとは？

- そこで、檀ラボではこれから新規にコードを書く際には最低限、以下のルールを守っていただこうと思います。
- なぜそのようなルールを設定したのかが分からない人は必ず先輩に質問して下さい。
- 基本的にPython・MATLAB・Rを想定して書きますが、他の言語でも各自で適切に判断をして下さい。
- ラボ全体としては細かいルールは不要だと思いますし、明確な目的がある際は以下のルールを逸脱しても構いません。
- 重要なのは**何も知らない初めて見る人の気持ちになって、誰でも理解できるコーディングを心がける**ことです。

<br>

## ソースコードの品質には妥協しないこと

- グチャグチャなコードを書くと皆の仕事が増えます。
- ソースコードの品質には妥協しないで下さい。慣れないうちほどコードの整理に時間をかけて下さい。
- 思い当たることはありませんか？
  - 3回以上同じ処理がある
  - 変数や関数の名前がグチャグチャでわかんなくなっている
  - 無意味な条件分岐やループがたくさんある
  - パラメータをハードコードしているせいで少しの変更で何行も同じことを書き換えなければいけない
  - 特定の環境でしか動作しない、記述が全くないからどの環境で動くのかよくわからない
  - 関数やメソッドにした方が簡潔な処理がある
  - ほぼ使われていない関数やクラスがある、似たような関数やクラスが複数ある
  - むやみなグローバル変数の使用
  - ベクトル化せずにループで処理している
  - 乱数発生にシード値を設定していない

品質の高いコードとは？

|||
|-|-|
| 可読性 | 改行、空白、インデントの適切使用や変数の命名等の形が一貫していて読みやすいこと |
| 保守性 | 構造が最適化されていて、解析や変更が容易でテストしやすいこと |
| 信頼性 | フェイルセーフやエラーハンドリングにより致命的なクラッシュやバグを回避できること |
| 移植性 | OSやハードウェア等の環境に依存しないこと |
| 拡張性 | 後から他の機能を追加しやすいこと |
| ドキュメント | 適切なコメントやドキュメンテーション、README |
| 効率性 | リソース(CPU、メモリなど)を必要以上に使用しないこと |
| セキュリティ | 現状、檀ラボでメモリ管理を伴う開発はないので被験者データの扱いが中心 |
| 再現性 | 科学計算を行う場合は計算結果が再現できること |

**やりっぱなしはとにかくダメです。ビギナーほど先輩のコードレビューを受けて下さい。**

<br>

## ハードコードの禁止

- とにかく後から変えやすいようにしましょう。
- これは皆、自然とできるようになるので今は省略。だれか加筆して下さい。

[加筆されるまではこちらのリンクを参照：  https://it-biz.online/it-skills/hard-coding/](https://it-biz.online/it-skills/hard-coding/)

<br>

## 開発環境の再現性

最低限の環境の再現性を担保しましょう。

READMEの環境欄には最低限、必ず以下の情報を書きましょう。

|||
|-|-|
| OS | 例：Windows 10/MacOS 12/Ubuntu 22.04など |
| アーキテクチャ | 例：x86_64/ARM64/ARM32など |
| 言語のバージョン | 例：Python 3.10/R 4.2/MATLAB R2022bなど |
| ハードウェア要件 | 必要に応じて記載する、特に実験プログラムは詳細な記述が必要 |
| 開発環境の環境ファイル | 下記参照 |

- パッケージの依存関係(どのパッケージのどのバージョンが必要か)を人力で解決するのはヒューマンエラーのもとです。
- 特にPythonの場合は仮想環境を多用するので、開発環境の情報をひとつのファイルにしてすぐに他のマシンに環境のクローンを移植できるようになっています。このファイルを環境ファイルと言います。
- 環境ファイルもしくは開発環境の詳細を記載したファイルを作り、プロジェクトディレクトリの中のどこかに必ず添付したうえでREADMEに必ず明記しておきましょう。

**開発環境がシビアな場合はDockerコンテナの利用を！**

以下、各言語の最低限の環境ファイルの出力について。もっと良い方法があれば、下記をアップデートしてください。

### Python

- Pythonは環境ファイルを必ず出力しておくこと。
  - venv    : "requirements.txt"
  - Anaconda: "(環境名).yml"

### MATLAB

- MATLABは環境ファイルが無い。
- 関数`ver`を実行すると環境に関する情報の一覧が表示されるのでそれをtxtファイル等に保存しておくこと。

### R

- Rは環境ファイルが無い。
- 関数`sessionInfo()`を実行すると環境に関する情報の一覧が表示されるのでそれをtxtファイル等に保存しておくこと。

<br>

## コードブロック付きのマークアップ言語を積極利用しましょう！

解析などで対話型のコード実行をする場合は以下のような実行可能なコードブロック付きのマークアップテキストの利用を推奨する。
コード付きの報告書を簡単に作成できる。

| ファイル形式名 | ファイル拡張子 | 主な対応言語 |
|---|---|---|
| Rマークダウン | .Rmd | R, Python, その他多数 |
| ジュピターノートブックファイル | .ipynb | Python, Sage math |
| MATLABライブスクリプト | .mlx | MATLAB |

```bash
# install jupyter notebook kernel
pip install ipykernel
```

```R
# install Rmarkdown package
install.packages("rmarkdown")
```


<br>

## 環境依存の絶対パスの禁止

- 無目的な**絶対パスのハードコードは悪です。** ファイルを別の場所に移動するだけで全く動作しなくなります。

```python

# hoge.txtの場所を指定するときにこーゆーの書いたらダメ
# hoge.txtを移動したり、違うPCを使うとコードが動かない
file_pass = "C:\scripts\example_files\hoge.txt"

```

明確な理由がある場合を除いて

1. **スクリプト自身の絶対パスを動的に取得したうえで**
2. **相対パスを使って他ファイルを参照すること**（下記参照）。

繰り返すが、間違っても絶対パスをハードコードするな。

注意点

- 相対パスを使うためにはコードとともに、関連するファイルを全てひとつのプロジェクトフォルダーの中に格納して必ずフォルダーごと移動するようにしてください。
- パス区切り文字はWindows(バックスラッシュ：`\`)とUNIX系(スラッシュ：`/`)で異なるので注意してください。MATLABとRではOSに関わらず普通のスラッシュ(`/`)を、Pythonは互換性がないので`os.path.join`を使って下さい。
- 以下はプロジェクトディレクトリ内にある"hoge.txt"というファイルのパスを取得する場面を想定したプログラムの例をPython,MATLAB,Rで示したものです。

```python
## python #####
import os

# 推奨される書き方
file_name = "hoge.txt"
home_dir  = os.path.dirname(__file__)         #この.pyファイルが存在するディレクトリのパスを取得
file_pass = os.path.join(home_dir, file_name) #hoge.txtのフルパス

# singleton false vs falsity
if not []:
   print("this will be printed")
if [] is False:
   print("this won't")

# ディレクトリ操作
curr_dir = os.getcwd() #カレントディレクトリ取得
os.chdir('..')        #一つ上のフォルダに移動

# 以下のように具体的にパスを書くのはダメ
file_pass = "C:\scripts\example_files\hoge.txt"
file_pass = "/scripts/example-files/hoge.txt"

```

**重要**
ジュピターノートブックの場合はファイルのパスを取得する手段は無い。コーディングの際は他人にわかりやすいように十分に注意すること。Do NOT change directory in Jupyter notebook.


```matlab
%% MATLAB %%%%%
clear

% 推奨される書き方
fileName = "hoge.txt";
homeDir  = fileparts(mfilename('fullpath')); %この.mファイルが存在するディレクトリのパスを取得
filePass = fullfile(homeDir, fileName);      %hoge.txtのフルパス

% ディレクトリ操作
currDir = pwd; %カレントディレクトリ取得
cd ../         %一つ上のフォルダに移動

% 以下のように具体的にパスを書くのはダメ
filePass = "C:\scripts\example_files\hoge.txt"
filePass = "/scripts/example-files/hoge.txt"

```

```R
## R #####
rm(list = ls())

# 推奨される書き方
file_name <- "hoge.txt"
if(rstudioapi::isAvailable()==TRUE){
    #この.Rファイルが存在するディレクトリのパスを取得
    home_dir <- dirmane(rstudioapi::getActiveDocumentContext()$path)
} else {
    home_dir <- getSrcDirectory()[1] #RStudioでない場合
}
file_pass <- c(home_dir, file_name)  #hoge.txtのフルパス

# ディレクトリ操作
curr_dir <- getwd() #カレントディレクトリ取得
setwd('../')        #一つ上のフォルダに移動

# 以下のように具体的にパスを書くのはダメ
file_pass <- "C:\scripts\example_files\hoge.txt"
file_pass <- "/scripts/example-files/hoge.txt"

```

ここで、Python・ＲとMATLAB変数の命名規則が異なることに注目してください。
PythonではPEP8の指定ではアンダースコアで結ぶ(snake case)ことになっていますが、RやMATLABには特に標準コーディング規約が無いので開発者が自由に決めています。上記のMATLABの例の書き方はcamel caseと呼ばれます。

変数・関数・クラス・ファイル名等の命名形式の例(どれを使っていいかは言語によって違う)

|||
|-|-|
| snake_case | アンダースコアで繋ぐ |
| camelCase/lowerCamelCase | 2語目以降の頭を大文字 |
| PascalCase/UpperCamelCase | 全ての語の頭を大文字 |
| kebab-case | ハイフンで繋ぐ(ファイル名等で使う) |
| name.unknown | ピリオドで繋ぐ(名称不明、クラスや構造体と紛らわしいので非推奨) |

フォーマットを統一しつつ、簡潔で意味の分かりやすい命名を心がけましょう。
当たり前ですが、日本語文字などの2バイト文字は避けましょう。
プロジェクト単位でコーディング規約が決まっている場合はそちらを優先してください。

<br>

## GitとGitHubの有効活用を

GitとGitHub、GitのGUIクライアントを積極的に使いましょう。
ただし、臨床データが含まれる場合はデータセットはGitHubにアップロード禁止です。

<br>




